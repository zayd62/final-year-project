# Data Gathering {#data-gathering-chapter}

As mentioned in Chapter \@ref(data-gathering), a test dataset is required in order to evaluate the different parsing methods as discussed in Chapter \@ref(query-parsing-chapter). 

```{bash generate-dataset-ERD-plantuml, include=FALSE}
cd "/media/zayd/Common/University/Year 3/Final Year Project/git-repository/Rmarkdown Report/figures/plantuml"
plantuml dataset-ERD.puml
```

## Gathering the Data {#gathering-data}

As discussed is Chapter \@ref(data-gathering), the data we will be gathering is **product data**. In order to obtain this data, we will be web scraping. The website we will be using is [https://www.bestwaywholesale.co.uk/](https://www.bestwaywholesale.co.uk/) [@bestwaywholesaleUKCashCarry] and we will use scrapy to perform the web scraping [@scrapyScrapyScrapy2019] and BeautifulSoup4 [@]


### Scraping {#scraping}

As mentioned in Chapter \@ref(gathering-data), we use scrapy, a python package to iterate through webpages, extracting the information required and storing it in a database. The database we are using is SQLite [@sqliteteamSQLiteHomePage] and SQLAlchemy [@sqlalchemySqlalchemySqlalchemy2019] is used as the ORM (see Chapter \@ref(definitions) for more information on ORMs)

Using [@krebsSQLAlchemyORMTutorial] as guidance on how to use SQLAlchemy, A database schema was designed and is visualised in figure \@ref(fig:dataset-schema-diagram) \newpage

```{r dataset-schema-diagram, echo=FALSE, fig.cap="Entity Relationship Diagram for the dataset"}
knitr::include_graphics("figures/plantuml/dataset-ERD.png")
```

The database fields mentioned in figure \@ref(fig:dataset-schema-diagram) are explained below 

- **category**
    - **id**: used as database primary key
    - **category**: name of the product category

- **page**
    - **id**: used as database primary key
    - **url**: for each category of products, the product information may span several "pages". 
    - **HTMLContent**: stores the HTML of the url above
    - **dateTimeCrawled**: the date and time the url was crawled
    - **category_id**: used to identify which entry in the category table this page belongs to

- **product**
    - **id**: used as database primary key
    - **url**: for each category of products, the product information may span several "pages". 
    - **HTMLContent**: stores the HTML of the product preview. A page contains multiple product previews. 
    - **page_id**: used to identify which entry in the page table this product belongs to

- **productData**
    - **id**: used as database primary key
    - **url**: for each category of products, the product information may span several "pages". 
    - **HTMLContent**: stores the HTML of the url above
    - **dateTimeCrawled**: the date and time the url was crawled
    - **price**: price of the product
    - **brand**: the brand of the product
    - **itemName**: the name of the product
    - **size**: the size of the product
    - **product_id**: used to identify which entry in the product table this entry belongs to
